From 509c33e27677f181c1bbe9fe2943b396725bd70e Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Julian=20R=C3=BCth?= <julian.rueth@fsfe.org>
Date: Wed, 21 Jun 2023 04:13:05 +0300
Subject: [PATCH] debug

---
 src/interpreter/llvm/src/lib/Support/CommandLine.cpp | 12 +++++++++---
 1 file changed, 9 insertions(+), 3 deletions(-)

diff --git a/src/interpreter/llvm/src/lib/Support/CommandLine.cpp b/src/interpreter/llvm/src/lib/Support/CommandLine.cpp
index 4ae3ad4..0e3426a 100644
--- a/src/interpreter/llvm/src/lib/Support/CommandLine.cpp
+++ b/src/interpreter/llvm/src/lib/Support/CommandLine.cpp
@@ -15,6 +15,8 @@
 //
 //===----------------------------------------------------------------------===//
 
+#include <boost/stacktrace.hpp>
+
 #include "llvm/Support/CommandLine.h"
 
 #include "DebugOptions.h"
@@ -183,8 +185,10 @@ public:
       return;
     if (!SC->OptionsMap.insert(std::make_pair(Name, &Opt)).second) {
       errs() << ProgramName << ": CommandLine Error: Option '" << Name
-             << "' registered more than once!\n";
+             << "' registered more than once (0)!\n";
+      errs() << boost::stacktrace::stacktrace();
       report_fatal_error("inconsistency in registered CommandLine options");
+
     }
 
     // If we're adding this to all sub-commands, add it to the ones that have
@@ -218,7 +222,8 @@ public:
       // Add argument to the argument map!
       if (!SC->OptionsMap.insert(std::make_pair(O->ArgStr, O)).second) {
         errs() << ProgramName << ": CommandLine Error: Option '" << O->ArgStr
-               << "' registered more than once!\n";
+               << "' registered more than once (1)!\n";
+        errs() << boost::stacktrace::stacktrace();
         HadErrors = true;
       }
     }
@@ -334,7 +339,8 @@ public:
     SubCommand &Sub = *SC;
     if (!Sub.OptionsMap.insert(std::make_pair(NewName, O)).second) {
       errs() << ProgramName << ": CommandLine Error: Option '" << O->ArgStr
-             << "' registered more than once!\n";
+             << "' registered more than once (2)!\n";
+      errs() << boost::stacktrace::stacktrace();
       report_fatal_error("inconsistency in registered CommandLine options");
     }
     Sub.OptionsMap.erase(O->ArgStr);
-- 
2.41.0

